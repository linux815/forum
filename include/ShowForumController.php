<?phpdeclare(strict_types=1);namespace App;class ShowForumController extends BaseController{    public ?array $user = [];    public int $online = 0;    public array $onlineUser = [];    private array $arrayThreads = [];    private array $arrayForums = [];    private int $forumId = 0;    private int $num = 3;    private int $page = 1;    private string $pervpage = '';    private string $nextpage = '';    private string $page2left = '';    private string $page1left = '';    private string $page1right = '';    private string $page2right = '';    private ?array $posts = null;    protected function onInput(): void    {        parent::onInput();        $database = new Database();        $mUsers = Users::Instance();        $this->title .= ' :: Список тем';        // Очистка старых сессий        $mUsers->ClearSessions();        // Текущий пользователь        $this->user = $mUsers->Get();        // Кто онлайн        $this->onlineUser = $mUsers->IsOnline();        $this->online = count($this->onlineUser);        // Получаем ID форума из GET с проверкой        $this->forumId = isset($_GET['id']) ? (int)$_GET['id'] : 0;        $this->arrayForums = $database->forums_select_podforum($this->forumId)->fetchAll();        $this->posts = $database->count_table($this->forumId)->fetchAll();        if (empty($this->posts[0]) || $this->posts[0] == 0) {            // Нет сообщений — выходим из метода            return;        }        // Параметр page с проверкой        $this->page = isset($_GET['page']) ? max(1, (int)$_GET['page']) : 1;        $totalPosts = (int)$this->posts[0];        $this->num = $totalPosts < 3 ? $totalPosts : 3;        $totalPages = (int)ceil($totalPosts / $this->num);        if ($this->page > $totalPages) {            $this->page = $totalPages;        }        $start = ($this->page - 1) * $this->num;        $this->arrayThreads = $database->thread_select($this->forumId, $start, $this->num)->fetchAll();        // Формируем навигацию        if ($this->page > 1) {            $this->pervpage = sprintf(                '<a href="index.php?c=showforum&id=%d&page=1"><<</a> <a href="index.php?c=showforum&id=%d&page=%d"><</a>',                $this->forumId,                $this->forumId,                $this->page - 1,            );        }        if ($this->page < $totalPages) {            $this->nextpage = sprintf(                '<a href="index.php?c=showforum&id=%d&page=%d">></a> <a href="index.php?c=showforum&id=%d&page=%d">>></a>',                $this->forumId,                $this->page + 1,                $this->forumId,                $totalPages,            );        }        if ($this->page - 2 > 0) {            $this->page2left = sprintf(                '<a href="index.php?c=showforum&id=%d&page=%d">%d</a> | ',                $this->forumId,                $this->page - 2,                $this->page - 2,            );        }        if ($this->page - 1 > 0) {            $this->page1left = sprintf(                '<a href="index.php?c=showforum&id=%d&page=%d">%d</a> | ',                $this->forumId,                $this->page - 1,                $this->page - 1,            );        }        if ($this->page + 1 <= $totalPages) {            $this->page1right = sprintf(                ' | <a href="index.php?c=showforum&id=%d&page=%d">%d</a>',                $this->forumId,                $this->page + 1,                $this->page + 1,            );        }        if ($this->page + 2 <= $totalPages) {            $this->page2right = sprintf(                ' | <a href="index.php?c=showforum&id=%d&page=%d">%d</a>',                $this->forumId,                $this->page + 2,                $this->page + 2,            );        }    }    protected function onOutput(): void    {        $vars = [            'array_forums' => $this->arrayForums,            'array_threads' => $this->arrayThreads,            'user' => $this->user,            'online' => $this->online,            'online_user' => $this->onlineUser,            'num' => $this->num,            'pervpage' => $this->pervpage,            'page2left' => $this->page2left,            'page1left' => $this->page1left,            'page' => $this->page,            'page1right' => $this->page1right,            'page2right' => $this->page2right,            'nextpage' => $this->nextpage,            'posts' => $this->posts,        ];        $this->content = $this->template('templates/v_showforum.php', $vars);        parent::onOutput();    }}