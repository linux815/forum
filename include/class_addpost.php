<?phpinclude_once('include/class_base.php');include_once('include/class_database.php');include_once('include/class_user.php');//// Контроллер страницы редактирования.//class C_AddPost extends C_Base{	private $header;  // заголовок	private $post_text;	// текст	private $titl;	private $text;	private $error;	// сообщение об ошибке		//	// Конструктор.	//	function __construct()	{			}		//	// Виртуальный обработчик запроса.	//	protected function OnInput()	{		parent::OnInput();				$database = new Database();				$this->title = $this->title . ' :: Добавление cообщения';				// Менеджеры.		$mUsers = M_Users::Instance();				// Очистка старых сессий.		$mUsers->ClearSessions();				// Текущий пользователь.		$this->user = $mUsers->Get();				if (isset($_POST['submitForm']))		{				$thread_id = $_GET['id'];			$forum_id = $_GET['forums'];			$header = "";			$post_text = $_POST['text'];						if ($this->user[0] <> "") 			{				// удачная отправка формы				$database->posts_insert($thread_id, $header, $this->user['id_user'], $post_text);				$database->forum_update_last($this->user['id_user'], $this->user['name'], $thread_id);				$database->forum_update_last2($this->user['id_user'], $this->user['name'], $forum_id, $thread_id);								unset($_SESSION['text']);				unset($_SESSION['quote']);								header('Location: index.php?c=showmessage&forums='.$forum_id.'&id='.$thread_id.'&page=1');				die();								} else echo "";			} else "";	}		//	// Виртуальный генератор HTML.	//		protected function OnOutput()	{		$vars = array('header' => $this->header, 'post_text' => $this->post_text, 'id_thread' => $this->id_threads);			$this->content = $this->Template('templates/v_addpost.php', $vars);		parent::OnOutput();	}	}