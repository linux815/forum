<?phpinclude_once('include/class_base.php');include_once('include/class_database.php');include_once('include/class_user.php');//// Конттроллер страницы чтения.//class C_Message extends C_Base{	private $tex;	// текст	private $id;	private $titl;	private $name;	private $surname;	public $user;	private $query_timer_total;	public $online;	public $online2;    private $t;	private $t2;    private $tx;	//	// Конструктор.	//	function __construct()	{		session_start();			}			//	// Виртуальный обработчик запроса.	//	protected function OnInput()	{		$database = new Database();		parent::OnInput();				$this->title = $this->title . ' :: Мои сообщения';						// Менеджеры.		$mUsers = M_Users::Instance();				// Очистка старых сессий.		$mUsers->ClearSessions();				// Текущий пользователь.		$this->user = $mUsers->Get();				$this->t = $mUsers->Message();		$this->t2 = $mUsers->Message2();			    if (isset($_GET['id']))		{			$id_message = $_GET['id'];			$row = $mUsers->message_select($id_message)->fetch(); 			$this->name = $row['name'];			$this->surname = $row['surname']; 						if ($row['take_count'] > 0) 				$this->titl = "RE(".$row['take_count'].")".$row['title'];				else 				$this->titl = $row['title'];				$this->tex = $row['content'];			}				if (isset($_GET['delete']))		{			$id_message = $_GET['delete'];						$row = $mUsers->message_delete($id_message);						header('Location: index.php?c=mail');		    die();			}		if ($_POST['submitForm'])		{			$title   = $row['title'];			$content = $_POST['text'];			$send_count = $row['send_count'] + 1;			$take_count = $row['take_count'] + 2;						$mUsers->message_insert($this->user['id_user'], $row['id_user'], $content, $title, $send_count, $take_count);					}		}		//	// Виртуальный генератор HTML.	//		protected function OnOutput()	{		$vars = array('title' => $this->titl, 'tex' => $this->tex, 'user' => $this->user, 't' => $this->t, 'tx' => $this->tx, 'name' => $this->name, 'surname' => $this->surname, 't2' => $this->t2);			$this->content = $this->Template('templates/v_message.php', $vars);		parent::OnOutput();	}	}