<?phpnamespace App;class ShowMessageController extends BaseController{    public ?array $user = [];    public int $online = 0;    public array $online_user = [];    private array $array_messages = [];    private int $i = 0;    private int $thread_id = 0;    private array $array_thread = [];    private int $num = 3;    private string $pervpage = '';    private string $page2left = '';    private string $page1left = '';    private int $page = 1;    private string $page1right = '';    private string $page2right = '';    private string $nextpage = '';    protected function OnInput(): void    {        $database = new Database();        parent::OnInput();        $this->title .= ' :: Посты';        $mUsers = Users::Instance();        $mUsers->ClearSessions();        $this->user = $mUsers->Get();        $this->online_user = $mUsers->Can();        $this->online = count($this->online_user ?? []);        $this->online_user = $mUsers->IsOnline();        $this->thread_id = isset($_GET['id']) ? (int)$_GET['id'] : 0;        $database->view_count($this->thread_id);        $this->array_thread = $database->thread_select_thread($this->thread_id)->fetchAll();        if ($_SERVER['REQUEST_METHOD'] === 'POST') {            if (isset($_POST['other'])) {                $_SESSION['text'] = $_POST['text'] ?? '';                header('Location: index.php?c=addpost&forums=' . ($_GET['forums'] ?? '') . '&id=' . $this->thread_id);                exit();            }            if (isset($_POST['submitForm'])) {                $thread_id = $this->thread_id;                $forum_id = isset($_GET['forums']) ? (int)$_GET['forums'] : 0;                $header = '';                $post_text = $_POST['text'] ?? '';                if (!empty($this->user) && ($this->user[0] ?? '') !== '') {                    $database->posts_insert($thread_id, $header, $this->user['id_user'], $post_text);                    $database->forum_update_last($this->user['id_user'], $this->user['name'], $thread_id);                    $database->forum_update_last2($this->user['id_user'], $this->user['name'], $forum_id, $thread_id);                    unset($_SESSION['text'], $_SESSION['quote']);                    header('Location: index.php?c=showmessage&forums=' . $forum_id . '&id=' . $thread_id . '&page=1');                    exit();                }            }        }        $this->page = isset($_GET['page']) ? max(1, (int)$_GET['page']) : 1;        $posts = $database->post_count($this->thread_id)->fetch();        $countPosts = (is_array($posts) && isset($posts[0])) ? (int)$posts[0] : 0;        $this->num = ($countPosts > 0 && $countPosts < 3) ? $countPosts : 3;        $total = ($this->num > 0) ? (int)(($countPosts - 1) / $this->num) + 1 : 1;        if ($this->page > $total) {            $this->page = $total;        }        $start = $this->page * $this->num - $this->num;        $this->array_messages = $database->post_select($this->thread_id, $start, $this->num)->fetchAll();        $forumsParam = htmlspecialchars($_GET['forums'] ?? '');        if ($this->page > 1) {            $this->pervpage = sprintf(                '<a href="index.php?c=showmessage&forums=%s&id=%d&page=1">&laquo;&laquo;</a>                   <a href="index.php?c=showmessage&forums=%s&id=%d&page=%d">&laquo;</a>',                $forumsParam, $this->thread_id, $forumsParam, $this->thread_id, $this->page - 1            );        }        if ($this->page < $total) {            $this->nextpage = sprintf(                ' <a href="index.php?c=showmessage&forums=%s&id=%d&page=%d">&raquo;</a>                   <a href="index.php?c=showmessage&forums=%s&id=%d&page=%d">&raquo;&raquo;</a>',                $forumsParam, $this->thread_id, $this->page + 1, $forumsParam, $this->thread_id, $total            );        }        if ($this->page - 2 > 0) {            $this->page2left = sprintf(                ' <a href="index.php?c=showmessage&forums=%s&id=%d&page=%d">%d</a> | ',                $forumsParam, $this->thread_id, $this->page - 2, $this->page - 2            );        }        if ($this->page - 1 > 0) {            $this->page1left = sprintf(                '<a href="index.php?c=showmessage&forums=%s&id=%d&page=%d">%d</a> | ',                $forumsParam, $this->thread_id, $this->page - 1, $this->page - 1            );        }        if ($this->page + 1 <= $total) {            $this->page1right = sprintf(                ' | <a href="index.php?c=showmessage&forums=%s&id=%d&page=%d">%d</a>',                $forumsParam, $this->thread_id, $this->page + 1, $this->page + 1            );        }        if ($this->page + 2 <= $total) {            $this->page2right = sprintf(                ' | <a href="index.php?c=showmessage&forums=%s&id=%d&page=%d">%d</a>',                $forumsParam, $this->thread_id, $this->page + 2, $this->page + 2            );        }    }    protected function OnOutput(): void    {        $vars = [            'array_messages' => $this->array_messages,            'user' => $this->user,            'online' => $this->online,            'online_user' => $this->online_user,            'array_podforums' => $this->array_podforums ?? [],            'array_thread' => $this->array_thread,            'num' => $this->num,            'pervpage' => $this->pervpage,            'page2left' => $this->page2left,            'page1left' => $this->page1left,            'page' => $this->page,            'page1right' => $this->page1right,            'page2right' => $this->page2right,            'nextpage' => $this->nextpage,        ];        $this->content = $this->Template('templates/v_showmessage.php', $vars);        parent::OnOutput();    }}