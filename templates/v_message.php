<?php/** * Шаблон главной страницы с поддержкой Bootstrap 5 * ================================================ * Переменные: *  - $title - заголовок *  - $text - массив из базы данных *  - $row - ассоциативный массив *  - $tex - текст сообщения (BBCode) */use JBBCode\Parser;use JBBCode\DefaultCodeDefinitionSet;// Функция для парсинга BBCode с заменой смайловfunction parseBBCodeWithSmiles(Parser $parser, string $text, array $smiles): string {    $textWithSmiles = strtr($text, $smiles);    $parser->parse($textWithSmiles);    return $parser->getAsHtml();}// Загружаем смайлы$pak = file('templates/smilies/Set_Smiles_YarNET.pak');$smiles = [];foreach ($pak as $val) {    $val = trim($val);    if (!$val || $val[0] === '#') continue;    list($gif, $alt, $symbol) = explode('=+:', $val);    $smiles[$symbol] = '<img src="templates/smilies/' . htmlspecialchars($gif) . '" alt="' . htmlspecialchars($alt) . '" />';}// Инициализируем парсер BBCode$parser = new Parser();$parser->addCodeDefinitionSet(new DefaultCodeDefinitionSet());// Текст из POST$text = $_POST['text'] ?? '';?><?php if (!isset($_GET['id'])): ?>    <?php if (empty($user)): ?>        <div class="alert alert-warning mt-4" role="alert">            Просмотр личных сообщений запрещен! Авторизируйтесь.        </div>    <?php else: ?>        <?php if ($user != 0): ?>            <nav class="my-3">                <a href="index.php?c=addmessage" class="btn btn-primary me-2">Написать сообщение</a>                <a href="index.php?c=mail" class="btn btn-secondary me-2">Входящие</a>                <a href="index.php?c=mail&output=1" class="btn btn-secondary">Исходящие</a>            </nav>        <?php endif; ?>        <form method="post" class="mt-3">            <div class="table-responsive">                <table class="table table-striped table-hover align-middle">                    <thead class="table-dark">                    <tr>                        <th style="width:5%"></th>                        <th style="width:35%">Заголовок сообщения</th>                        <th style="width:30%">Отправитель</th>                        <th style="width:25%">Дата</th>                        <th style="width:5%; text-align:center;">Действия</th>                    </tr>                    </thead>                    <tbody>                    <?php if (!isset($_GET['output'])): ?>                        <?php foreach ($t as $row): ?>                            <tr>                                <td class="text-center"><img src="./images/user.gif" alt="User" /></td>                                <td>                                    <a href="index.php?c=mail&id=<?= htmlspecialchars($row['id_message']) ?>">                                        <?= ($row['take_count'] == 0)                                            ? htmlspecialchars($row['title'])                                            : "RE(" . intval($row['take_count']) . "): " . htmlspecialchars($row['title']); ?>                                    </a>                                </td>                                <td><?= htmlspecialchars($row['name']) ?></td>                                <td><?= htmlspecialchars($row['date']) ?></td>                                <td class="text-center">                                    <a href="index.php?c=mail&delete=<?= htmlspecialchars($row['id_message']) ?>" class="btn btn-sm btn-danger">Удалить</a>                                </td>                            </tr>                        <?php endforeach; ?>                    <?php else: ?>                        <?php foreach ($t2 as $row): ?>                            <tr>                                <td class="text-center"><img src="./images/user.gif" alt="User" /></td>                                <td>                                    <a href="index.php?c=mail&id=<?= htmlspecialchars($row['id_message']) ?>">                                        <?= ($row['send_count'] == 0)                                            ? htmlspecialchars($row['title'])                                            : "RE(" . intval($row['send_count']) . "): " . htmlspecialchars($row['title']); ?>                                    </a>                                </td>                                <td><?= htmlspecialchars($row['name']) ?></td>                                <td><?= htmlspecialchars($row['date']) ?></td>                                <td class="text-center">                                    <a href="index.php?c=mail&delete=<?= htmlspecialchars($row['id_message']) ?>" class="btn btn-sm btn-danger">Удалить</a>                                </td>                            </tr>                        <?php endforeach; ?>                    <?php endif; ?>                    </tbody>                </table>            </div>        </form>    <?php endif; ?><?php else: ?>    <div class="container mt-4">        <h5>От кого: <u><i><?= htmlspecialchars($name) ?></i></u></h5>        <h4>Тема сообщения: <?= htmlspecialchars($title) ?></h4>        <hr>        <div class="postbody border rounded p-3 bg-light">            <?= parseBBCodeWithSmiles($parser, $tex ?? '', $smiles) ?>        </div>        <?php define('IRB_BB_PATH', 'https://' . $_SERVER['HTTP_HOST'] . '/bbcode'); ?>        <link rel="stylesheet" href="<?= IRB_BB_PATH ?>/styles/modalbox.css" />        <link href="style1.css" rel="stylesheet" />        <script src="<?= IRB_BB_PATH ?>/js/modalbox.js"></script>        <script src="<?= IRB_BB_PATH ?>/js/bb.js"></script>        <!-- Smilies modal and BBcode buttons section can stay unchanged or be adapted if needed -->        <div id="post" class="mt-4">            <form method="post" action="">                <div class="mb-2">                    <select name="color" class="form-select form-select-sm d-inline-block w-auto"                            onchange="click_bb('text', 'color=' + this.value, 'color')">                        <option value="">цвет</option>                        <option value="gray">серый</option>                        <option value="green">зеленый</option>                        <option value="purple">фиолетовый</option>                        <option value="olive">оливковый</option>                        <option value="silver">серебряный</option>                        <option value="aqua">морской</option>                        <option value="yellow">желтый</option>                        <option value="blue">синий</option>                        <option value="orange">оранжевый</option>                        <option value="red">красный</option>                    </select>                    <select name="size" class="form-select form-select-sm d-inline-block w-auto ms-2"                            onchange="click_bb('text', 'size=' + this.value, 'size')">                        <option value="">размер</option>                        <option value="8">8</option>                        <option value="9">9</option>                        <option value="10">10</option>                        <option value="11">11</option>                        <option value="12">12</option>                        <option value="14">14</option>                        <option value="16">16</option>                        <option value="18">18</option>                        <option value="20">20</option>                        <option value="22">22</option>                        <option value="24">24</option>                        <option value="26">26</option>                        <option value="28">28</option>                        <option value="36">36</option>                        <option value="48">48</option>                        <option value="72">72</option>                    </select>                    <select name="head" class="form-select form-select-sm d-inline-block w-auto ms-2"                            onchange="click_bb('text', 'h' + this.value)">                        <option value="">заголовки</option>                        <option value="1">H1</option>                        <option value="2">H2</option>                        <option value="3">H3</option>                        <option value="4">H4</option>                        <option value="5">H5</option>                    </select>                </div>                <div class="mb-3">                    <!-- BBCode buttons -->                    <!-- Можно добавить Bootstrap классы, если нужно. Оставлю как есть для простоты -->                    <img id="1" alt="Жирный" title="Жирный" src="<?= IRB_BB_PATH ?>/images/bold.gif" onclick="click_bb('text', 'b');" style="cursor:pointer;" />&nbsp;                    <img id="2" alt="Курсив" title="Курсив" src="<?= IRB_BB_PATH ?>/images/italics.gif" onclick="click_bb('text', 'i');" style="cursor:pointer;" />&nbsp;                    <img id="3" alt="Подчеркнутый" title="Подчеркнутый" src="<?= IRB_BB_PATH ?>/images/underline.gif" onclick="click_bb('text', 'u');" style="cursor:pointer;" />&nbsp;                    <img id="4" alt="Зачеркнутый" title="Зачеркнутый" src="<?= IRB_BB_PATH ?>/images/strikethrough.gif" onclick="click_bb('text', 's');" style="cursor:pointer;" />&nbsp;                    <img id="5" alt="Подстрочный" title="Подстрочный" src="<?= IRB_BB_PATH ?>/images/subscript.gif" onclick="click_bb('text', 'sub');" style="cursor:pointer;" />&nbsp;                    <img id="6" alt="Надстрочный" title="Надстрочный" src="<?= IRB_BB_PATH ?>/images/superscript.gif" onclick="click_bb('text', 'sup');" style="cursor:pointer;" />&nbsp;                    <img id="7" alt="По ширине" title="По ширине" src="<?= IRB_BB_PATH ?>/images/justify.gif" onclick="click_bb('text', 'justify');" style="cursor:pointer;" />&nbsp;                    <img id="8" alt="По левому краю" title="По левому краю" src="<?= IRB_BB_PATH ?>/images/left.gif" onclick="click_bb('text', 'left');" style="cursor:pointer;" />&nbsp;                    <img id="9" alt="По центру" title="По центру" src="<?= IRB_BB_PATH ?>/images/center.gif" onclick="click_bb('text', 'center');" style="cursor:pointer;" />&nbsp;                    <img id="10" alt="По правому краю" title="По правому краю" src="<?= IRB_BB_PATH ?>/images/right.gif" onclick="click_bb('text', 'right');" style="cursor:pointer;" />&nbsp;                    <br />                    <img id="11" alt="Вставить список" title="Вставить список" src="<?= IRB_BB_PATH ?>/images/list_ordered.gif" onclick="click_bb('text', 'list=1', 'list');" style="cursor:pointer;" />&nbsp;                    <img id="12" alt="Вставить список" title="Вставить список" src="<?= IRB_BB_PATH ?>/images/list_unordered.gif" onclick="click_bb('text', 'list');" style="cursor:pointer;" />&nbsp;                    <img id="22" alt="Вставить пункт списка" title="Вставить пункт списка" src="<?= IRB_BB_PATH ?>/images/li.gif" onclick="click_zv('text', '*');" style="cursor:pointer;" />&nbsp;                    <img id="17" alt="Вставить код" title="Вставить код" src="<?= IRB_BB_PATH ?>/images/view_php.gif" onclick="click_bb('text', 'php', 'php');" style="cursor:pointer;" />&nbsp;                    <img id="18" alt="Цитата" title="Цитата" src="<?= IRB_BB_PATH ?>/images/quote.gif" onclick="click_bb('text', 'quote');" style="cursor:pointer;" />&nbsp;                    <img id="20" alt="Вставить гиперсылку" title="Вставить гиперсылку" src="<?= IRB_BB_PATH ?>/images/insert_hyperlink.gif" onclick="click_url();" style="cursor:pointer;" />&nbsp;                    <img id="21" alt="Вставить изображение" title="Вставить изображение" src="<?= IRB_BB_PATH ?>/images/insert_picture.gif" onclick="click_image();" style="cursor:pointer;" />&nbsp;                    <img id="30" alt="Вставить адрес электронной почты" title="Вставить адрес электронной почты" src="<?= IRB_BB_PATH ?>/images/email.png" onclick="click_email();" style="cursor:pointer;" />&nbsp;                </div>                <textarea id="text" name="text" class="form-control mb-3" rows="15"                          onselect="savesel(this)" onchange="savesel(this)" onclick="savesel(this)" onfocus="savesel(this)" onkeyup="savesel(this)"><?= htmlspecialchars("[quote]" . ($tex ?? '') . "[/quote]") ?></textarea>                <button type="submit" name="submitForm" class="btn btn-primary me-2">Ответить</button>                <button type="submit" name="ok" class="btn btn-secondary me-2">Предварительный просмотр</button>                <button type="button" class="btn btn-light" onclick="history.go(-1)">Отмена</button>            </form>        </div>    </div><?php endif; ?>